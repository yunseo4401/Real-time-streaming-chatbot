<!DOCTYPE html>
<html>



<head>
    <!-- Basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- Site Metas -->
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    
  
    <title> Real-time CHATBOT </title>
  
  
    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap.css" />
  
    <!--한글폰트-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
  
    
    <!-- font awesome style -->
    <link href="static/css/font-awesome.min.css" rel="stylesheet" />
  
    <!-- Custom styles for this template -->
    <link href="static/css/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="static/css/responsive.css" rel="stylesheet" />
  
</head>

<body>
    <div class="overlay" id="overlay">
      </div>
      <!--팝업창 2개 설정-->
      <script>
        function openPopup() {
          var width = 400;
          var height = 300;
    
          var leftPosition = (window.screen.width - width) / 2;
          var topPosition = (window.screen.height - height) / 2;
    
          var popupWindow1 = window.open("", "popupWindow1", "width=" + width + ",height=" + height + ",left=" + leftPosition + ",top=" + topPosition);
    
          popupWindow1.document.write(`
          <!DOCTYPE html>
          <html lang="ko">
          <head>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>팝업창 1</title>
            <style>
              body { 
                font-family: "Gowun Batang", sans-serif; 
                text-align: center; 
                padding: 20px; 
              }
              .text-box {
                border: 1px solid #c4c4c4;
                background-color: #f0f0f0;
                padding: 20px;
                margin-bottom: 20px;
                display: block;
              }
              .button-container {
                display: flex;
                justify-content: center;
                gap: 10px; 
              }
              button { 
                font-family: "Gowun Batang", sans-serif; 
                padding: 8px 16px; 
                font-size: 14px; 
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
              }
              button:hover {
                background-color: #0056b3;
              }
              h1 {
                font-size: 17px;
              }
            </style>
          </head>
          <body>
            <h1>Agreement</h1>
            <div class="text-box">
              <p>Everything in this chat is recorded and used to collect data for this study. Insights obtained from the analysis can be published without the consent of the user. Do you agree with this?</p>
            </div>
            <div class="button-container">
              <button id="agreeBtn">Agree</button>
              <button id="disagreeBtn">Disagree</button>
            </div>
          </body>
          </html>
          `);
    
          popupWindow1.document.close(); // 문서의 쓰기를 완료하고 해석을 시작하게 함
    
          popupWindow1.onload = function() {
            popupWindow1.document.getElementById('agreeBtn').onclick = function() {
              popupWindow1.close();
              setTimeout(openSecondPopup, 100); // 첫 번째 팝업 창이 닫힌 후 두 번째 팝업 창을 엽니다.
            };
            popupWindow1.document.getElementById('disagreeBtn').onclick = function() {
              popupWindow1.close();
              alert("You didn't agree. If you don't agree, we can't proceed with the chat.");
              
            };
          };
        }
    
        function openSecondPopup() {
          var width = 400;
          var height = 300;
    
          var leftPosition = (window.screen.width - width) / 2;
          var topPosition = (window.screen.height - height) / 2;
    
          var popupWindow2 = window.open("", "popupWindow2", "width=" + width + ",height=" + height + ",left=" + leftPosition + ",top=" + topPosition);
    
          popupWindow2.document.write(`
          <!DOCTYPE html>
          <html lang="ko">
          <head>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang&display=swap" rel="stylesheet">
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>팝업창 2</title>
            <style>
              body { 
                font-family: "Gowun Batang", sans-serif; 
                text-align: center; 
                padding: 20px; 
              }
              .text-box {
                border: 1px solid #c4c4c4;
                background-color: #f0f0f0;
                padding: 20px;
                margin-bottom: 20px;
                display: block; 
              }
              .button-container {
                display: flex;
                justify-content: center;
                gap: 10px;
              }
              button { 
                font-family: "Gowun Batang", sans-serif; 
                padding: 8px 16px; 
                font-size: 14px; 
                background-color: #007bff;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
              }
              button:hover {
                background-color: #0056b3;
              }
              h1 {
                font-size: 17px; 
              }
            </style>
          </head>
          <body>
            <h1>Subject Select</h1>
            <div class="text-box">
              <p>Please choose which topic to chat with. Please decide whether to have a daily conversation with artificial intelligence or a topic-based conversation.</p>
            </div>
            <div class="button-container">
              <button id="talkBtn">Daliy conversation</button>
              <button id="taskBtn">Topic-based conversation</button>
            </div>
          </body>
          </html>
          `);
    
          popupWindow2.document.close(); // 문서의 쓰기를 완료하고 해석을 시작하게 함
    
          popupWindow2.onload = function() {
          popupWindow2.document.getElementById('talkBtn').onclick = function() {
          alert('You have chosen a daily conversation.');
          popupWindow2.close();
          window.removeOverlay(); // 오버레이 제거
                     // 오버레이 제거
        };
        popupWindow2.document.getElementById('taskBtn').onclick = function() {
          alert('You have chosen a topic-based conversation.');
          popupWindow2.close();
          window.removeOverlay();
        };
      };
    }

        function removeOverlay() {
      document.getElementById('overlay').classList.add('hidden');
    }
    
        // 페이지가 로드될 때 openPopup 함수를 호출합니다.
        window.onload = openPopup;
      </script>


    <div class="hero_area">
      <!-- header section strats -->
      <header class="header_section">
        <div class="header_top">
          <div class="container-fluid ">
            <div class="contact_nav", style="display: flex; justify-content: center; align-items: center; height: 100%;">
            </div>
          </div>
        </div>
        <div class="header_bottom">
          <div class="container-fluid">
            <nav class="navbar navbar-expand-lg custom_nav-container ">
              <a class="navbar-brand" href="https://hli.skku.edu/", style="display: flex; justify-content: center; align-items: center; height: 100%;">
                <i class="fa fa-check-circle fa-2x" aria-hidden="true"></i>
                <span style="margin-left: 15px;">
                     Real-Time Streaming ChatBot
                </span>
              </a>
            </nav>
          </div>
        </div>
      </header>
      <!-- end header section --> 

      <div class="container">
        <h3 class=" text-center"></h3>
              <div class="inbox_msg">
                <div class="mesgs">
                  <div class="msg_history" id="msg_history">
                    <!--보내는 메세지-->
                    <div class="outgoing_msg">
                      <div class="sent_msg">
                        <p>첫번째 예시 메시지입니다. </p>
                        <span class="time_date"> 11:01 AM    |    June 9</span> </div>
                    </div>
                    <!--Ai 답장-->
                    <div class="incoming_msg">
                        <div class="incoming_msg_img"> <img src="https://cdn-icons-png.flaticon.com/512/5043/5043967.png" alt="sunil"> </div>
                        <div class="received_msg">
                          <div class="received_withd_msg">
                            <p>샘플 답장입니다. 
                              </p>
                            <span class="time_date"> 11:01 AM    |    June 9</span></div>
                        </div>
                      </div>
                      <div class="typing-indicator" id="typing-indicator"></div>
                  </div>
    
                  </div>

                  <div class="type_msg">
                    <div class="input_msg_write">
                      <input type="text" id="write_msg"class="write_msg" placeholder="Type a message" />
                      <button class="msg_send_btn" id="msg_send_btn" type="button" onclick="sendMessage()"><i class="fa fa-paper-plane-o" aria-hidden="true"></i></button>
                    </div>
                  </div>
                </div>
              </div>
              
              
              <p class="text-center top_spac"><a target="_blank" href="https://hli.skku.edu/">SungKyunKwan University</a></p>
              
            </div>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
            const chatInput = document.getElementById('write_msg');
            const chatWindow = document.getElementById('msg_history');
            const typingIndicator = document.getElementById('typing-indicator');
            const sendButton = document.getElementById('msg_send_btn');
            

             chatInput.addEventListener('input', function() {
        const text = chatInput.value;
        if (text) {
            typingIndicator.textContent = text;
            typingIndicator.style.display = 'block';
            chatWindow.appendChild(typingIndicator);
        } else {
            typingIndicator.textContent = '';
            typingIndicator.style.display = 'none';
        }
    });
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    sendMessage();
                }
            });

            function sendMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    const messageElement = document.createElement('div');
                    messageElement.classList.add('outgoing_msg');
                    messageElement.innerHTML = `
                        <div class="sent_msg">
                            <p>${message}</p>
                            <span class="time_date">${getCurrentTime()}</span>
                        </div>
                    `;
                    chatWindow.appendChild(messageElement);
                    chatInput.value = '';
                    typingIndicator.textContent = '';
                    typingIndicator.style.display = 'none';
                    chatWindow.scrollTop = chatWindow.scrollHeight;


                    // Send message to server
                    sendMessageToServer(message, getCurrentTime());
                }
            }

            function getCurrentTime() {
                var now = new Date();
                var hours = now.getHours();
                var minutes = now.getMinutes();
                var ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12;
                minutes = minutes < 10 ? '0' + minutes : minutes;

                var monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
                var month = monthNames[now.getMonth()];
                var day = now.getDate();

                return hours + ':' + minutes + ' ' + ampm + ' | ' + month + ' ' + day;
            }

            function sendMessageToServer(content, timestamp) {
                fetch('/send_message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ content: content, timestamp: timestamp })
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }
        });

    
    </script>
</body>
</html>

